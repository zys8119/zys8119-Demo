import{i as B}from"./15558-6954c0c4.js";import{d as S,r as D,h as $,o as L,c as N,a as O,_ as V}from"./index-76c60e35.js";const X=u=>{const d={x:0,y:0,width:null,height:null,devicePixelRatio:window.devicePixelRatio};switch(Object.prototype.toString.call(u)){case"[object Undefined]":case"[object Number]":d.devicePixelRatio=u||window.devicePixelRatio;break;case"[object Object]":Object.assign(d,u);break;default:throw"The options parameter is incorrect. The parameter must be number or object."}return d},Y=(u,d,m)=>{const{devicePixelRatio:n,x:v,y:_,width:b,height:I}=X(m);return new Promise((P,R)=>{try{const a=document.createElement("canvas"),y=a.getContext("2d"),r=typeof u=="string"?new Image:u,j=()=>{a.width=r.width*n,a.height=r.height*n,y.drawImage(r,0,0);const k=v||0,g=_||0,h=b||a.width,p=I||a.height,x=y.getImageData(k,g,h,p).data,w=4;for(let l=0,e=x.length;l<e;l+=w){const t=x[l],s=x[l+1],c=x[l+2],o=x[l+3],i=`rgba(${t},${s},${c},${o})`,f=l/w,M=f%h+k,C=Math.floor(f/h)+g;typeof d=="function"&&(d==null||d({r:t,g:s,b:c,a:o,rgba:i,index:f,x:M,y:C,isStart:l===0,lng:e,key:l,max:w,isEnd:l===e-w,canvasWidth:a.width,canvasHeight:a.height}))}a.remove(),P(r)};typeof u=="string"?(r.src=u,r.onload=j):j()}catch(a){R(a)}})},H={class:"aaa"},W=S({__name:"Image-boundary-coordinate-conversion",setup(u){const d=D();return $(async()=>{const m=d.value;m.width=window.innerWidth,m.height=window.innerHeight;const n=m.getContext("2d"),v=[],_=new Map;await Y(B,e=>{v.push(e),_.set([e.x,e.y].join(),e)},{});const b=(e,t)=>[[e-1,t-1],[e,t-1],[e+1,t-1],[e-1,t],[e+1,t],[e-1,t+1],[e,t+1],[e+1,t+1]],I=({x:e,y:t,canvasWidth:s,canvasHeight:c,a:o})=>b(e,t).some(i=>{var f;return((f=_.get(i.join()))==null?void 0:f.a)===0})||o!==0&&(t===0||e===0||e===s-1||t===c-1),P=new Map,R=v.filter(e=>{if(e.a!==0&&I(e))return P.set([e.x,e.y].join(),e),!0}),a=[],y=new Map;let r=null;const j=e=>{const{x:t,y:s}=e;return b(t,s).map(o=>P.get(o.join())).filter(o=>o&&!y.get([o.x,o.y].join()))[0]||e};R.forEach((e,t)=>{n.beginPath(),n.fillStyle=e.rgba,n.rect(e.x,e.y,3,3),n.fill(),t===0?r=e:r=j(r),r&&(a.push(r),y.set([r.x,r.y].join(),r))}),n.beginPath(),n.strokeStyle="#f00",a.forEach((e,t)=>{t===0?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}),n.stroke(),console.log(a.length);function k(e){if(e.length<3)return!1;const t=e[1][0]-e[0][0],s=e[1][1]-e[0][1];for(let c=2;c<e.length;c++){const o=e[c][0]-e[0][0],i=e[c][1]-e[0][1];if(t*i!==s*o)return!1}return!0}const g=[];let h=[];a.forEach((e,t)=>{h.length<3||k(h.map(s=>[s.x,s.y]))?h.push(e):(g.push.apply(g,h.slice(0,h.length-1)),h=[h.pop()])}),n.beginPath(),n.strokeStyle="#4800ff",g.forEach((e,t)=>{t===0?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}),n.stroke(),console.log(g.length);function p(e,t){if(e.length<=2)return e;let s=0,c=0;for(let o=1;o<e.length-1;o++){const i=x(e[o],e[0],e[e.length-1]);i>s&&(s=i,c=o)}if(s>t){const o=p(e.slice(0,c+1),t),i=p(e.slice(c),t);return o.slice(0,-1).concat(i)}else return[e[0],e[e.length-1]]}function x(e,t,s){const{x:c,y:o}=e,{x:i,y:f}=t,{x:M,y:C}=s,E=Math.abs((M-i)*(f-o)-(i-c)*(C-f)),T=Math.sqrt(Math.pow(M-i,2)+Math.pow(C-f,2));return E/T}const l=p(g,2);n.beginPath(),n.strokeStyle="#208300",l.slice(0,50).forEach((e,t)=>{t===0?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}),n.stroke(),console.log(l.length)}),(m,n)=>(L(),N("div",H,[O("canvas",{ref_key:"canvasRef",ref:d},null,512)]))}});const J=V(W,[["__scopeId","data-v-cfd6926b"]]);export{J as default};

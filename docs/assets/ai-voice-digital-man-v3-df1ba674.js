import{d as Q,r as o,g as X,h as Z,o as w,c as b,a as t,C as I,F as ee,b as ae,D as te,n as ne,u as r,t as oe,H as se,_ as ie}from"./index-71ff745c.js";import{t as ce,q as re,m as le}from"./ai-b-cf3f840e.js";import{l as L}from"./lodash-d2667470.js";import{S as ue}from"./svg-icon-4f457caa.js";import{b as pe,u as de}from"./index-710fd454.js";import"./_commonjsHelpers-87174ba5.js";import"./format-length-c9d165c6.js";const B=""+new URL("ai-bainian-c48efd1f.mp4",import.meta.url).href,C=""+new URL("ai-jieshu-8b911c9d.mp4",import.meta.url).href,H=""+new URL("ai-jieshu2-1e46aa46.mp4",import.meta.url).href,fe=""+new URL("bg-c56a087a.mp3",import.meta.url).href,me={class:"ai-voice bg-#f7d6b8 abs-content of-hidden"},he=["src"],ye=["src"],_e=["src"],ge=["src"],ve=["src"],we=["src"],be=["src"],ke=["src"],xe=["onClick"],Re={class:"text-14px"},Fe={class:"abs-r z--1"},Se=["src"],qe=["src"],Me=["src"],Ue=["src"],Ve=Q({__name:"ai-voice-digital-man-v3",setup(je){const T=se(),{toggle:z}=pe(),u=o(),k=o(),x=o(),R=o(),A=X(()=>T.query.key==="true"),E=async()=>{u.value.paused?u.value.play():u.value.pause()},W=ce({similarity:.4,smoothness:.05,spill:.05}),d=async(e,a,n)=>{const{clip:c,mp4Info:l}=n;async function _(P=0,m,Y,G){const J=Number((l.duration/l.timescale).toFixed(0));typeof m!="number"&&(m=J);const g=m-P,O=(Y||g)*1e3,D=async h=>{const v=G?m-g*h:P+g*h,y=await c.getVideoFrame(v);if(y){a.clearRect(0,0,a.canvas.width,a.canvas.height);const s=await W(y);a.drawImage(s,0,0,s.codedWidth,s.codedHeight,(a.canvas.width-s.codedWidth)/2,a.canvas.height-s.codedHeight,s.codedWidth,s.codedHeight)}};return new Promise(h=>{const v=performance.now();(async function y(){const s=(performance.now()-v)/O;if(s>1){await D(1),h();return}await D(s),requestAnimationFrame(y)})()})}return _},f=async e=>{const a=await fetch(e),n=new re(a.body),c=await n.ready,l=await n.getInfo();return{clip:n,mp4Info:l,body:c}},F=o(),S=o(),q=o(),M=o(),U=o(),i=o(!1),p=async e=>{await F.value(2.9,3.3,2,e),i.value||await p(!e)},V=L.debounce(async(e,a)=>{e.width=window.innerWidth*window.devicePixelRatio,e.height=window.innerHeight*window.devicePixelRatio},300);Z(async()=>{u.value.volume=.05;const e=U.value,a=e.getContext("2d"),n=await f(le);F.value=await d(e,a,n);const c=await f(B);S.value=await d(e,a,c);const l=await f(C);q.value=await d(e,a,l);const _=await f(H);M.value=await d(e,a,_),V(e,a),window.addEventListener("resize",()=>{V(e,a)}),await p()});const $=async()=>{i.value=!0,setTimeout(()=>{requestAnimationFrame(async()=>{k.value.play(),await S.value(),i.value=!1,await p()})},2e3)},N=async()=>{i.value=!0,setTimeout(()=>{requestAnimationFrame(async()=>{x.value.play(),await q.value(),i.value=!1,await p()})},2e3)},K=async()=>{i.value=!0,setTimeout(()=>{requestAnimationFrame(async()=>{R.value.play(),await M.value(),i.value=!1,await p()})},2e3)},j=o([{name:"背景音乐",icon:"yinyue",click(){E()},key:"1"},{name:"全屏",icon:"quanping",click(){z()},key:"2"},{name:"拜年",icon:"bainian",click(){$()},key:"3"},{name:"结语",icon:"fu",click(){N()},notFill:!0,key:"4"},{name:"结语2",icon:"fu",click(){K()},notFill:!0,key:"9"}]);return de({onEventFired:L.debounce(e=>{const a=j.value.find(n=>n.key===e.key);a&&a.click&&a.click()},300)}),(e,a)=>(w(),b("div",me,[t("img",{class:"abs-content bg",src:"./ai/bg.png",alt:""},null,8,he),t("img",{class:"abs-start-bottom w-100% footer",src:"./ai/footer.png",alt:""},null,8,ye),t("img",{class:"abs-start-bottom house",src:"./ai/house-left.png",alt:""},null,8,_e),t("img",{class:"abs-end-bottom house",src:"./ai/house-right.png",alt:""},null,8,ge),t("img",{class:"abs-start w-183px left-13% top-5% yun-up",src:"./ai/yun-up.png",alt:""},null,8,ve),t("img",{class:"abs-end-bottom right-13% bottom-30px yun-down",src:"./ai/yun-down.png",alt:""},null,8,we),t("img",{class:"abs-start w-300px top-10% left--70px jack-left",src:"./ai/jack-left.png",alt:""},null,8,be),t("img",{class:"abs-end w-300px top-10% right--70px jack-right",src:"./ai/jack-right.png",alt:""},null,8,ke),t("canvas",{class:"abs-content",ref_key:"canvasRef",ref:U,style:I(`transform: scale(${e.$route.query.scale||1}) translateY(${e.$route.query.y||0}%)`)},null,4),t("div",{class:"abs-end-bottom rigth-30px bottom-30px flex-center gap-5px flex-col items-end text-50px text-#ff0052",style:I({display:r(A)?"none":"flex"})},[(w(!0),b(ee,null,ae(r(j),(n,c)=>(w(),b("div",{key:c,class:"bg-#fff1 hover:bg-#fff5 w-100px p-15px b-rd-y-10px cursor-pointer flex-center flex-col",onClick:te(n.click,["stop"])},[ne(r(ue),{name:n.icon,"not-fill":n.notFill},null,8,["name","not-fill"]),t("div",Re,oe(n.name),1)],8,xe))),128))],4),t("div",Fe,[t("audio",{src:r(fe),autoplay:"",ref_key:"audioRef",ref:u,loop:""},null,8,Se),t("video",{ref_key:"bainianRef",ref:k,src:r(B)},null,8,qe),t("video",{ref_key:"perorationRef",ref:x,src:r(C)},null,8,Me),t("video",{ref_key:"peroration2Ref",ref:R,src:r(H)},null,8,Ue)])]))}});const Te=ie(Ve,[["__scopeId","data-v-1632d35f"]]);export{Te as default};

import{a as M,C as k,L as E,F as H,G as J,B as P,b as j,c as C,M as U,P as _,d as q,e as z,f as A,g as B,h as N,i as W,j as Z,V as G,D as K,T as Q,s as X}from"./BaseThree-3cf0151f.js";const Y=/^[og]\s*(.+)?/,$=/^mtllib /,ee=/^usemtl /,te=/^usemap /,R=/\s+/,S=new M,I=new M,T=new M,D=new M,y=new M,V=new k;function se(){const L={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,s){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=s!==!1;return}const r=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:s!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,i){const c=this._finalize(!1);c&&(c.inherited||c.groupCount<=0)&&this.materials.splice(c.index,1);const o={index:this.materials.length,name:e||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:c!==void 0?c.smooth:this.smooth,groupStart:c!==void 0?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){const n={index:typeof a=="number"?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return n.clone=this.clone.bind(n),n}};return this.materials.push(o),o},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),e&&this.materials.length>1)for(let c=this.materials.length-1;c>=0;c--)this.materials[c].groupCount<=0&&this.materials.splice(c,1);return e&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},r&&r.name&&typeof r.clone=="function"){const e=r.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,s){const r=parseInt(t,10);return(r>=0?r-1:r+s/3)*3},parseNormalIndex:function(t,s){const r=parseInt(t,10);return(r>=0?r-1:r+s/3)*3},parseUVIndex:function(t,s){const r=parseInt(t,10);return(r>=0?r-1:r+s/2)*2},addVertex:function(t,s,r){const e=this.vertices,i=this.object.geometry.vertices;i.push(e[t+0],e[t+1],e[t+2]),i.push(e[s+0],e[s+1],e[s+2]),i.push(e[r+0],e[r+1],e[r+2])},addVertexPoint:function(t){const s=this.vertices;this.object.geometry.vertices.push(s[t+0],s[t+1],s[t+2])},addVertexLine:function(t){const s=this.vertices;this.object.geometry.vertices.push(s[t+0],s[t+1],s[t+2])},addNormal:function(t,s,r){const e=this.normals,i=this.object.geometry.normals;i.push(e[t+0],e[t+1],e[t+2]),i.push(e[s+0],e[s+1],e[s+2]),i.push(e[r+0],e[r+1],e[r+2])},addFaceNormal:function(t,s,r){const e=this.vertices,i=this.object.geometry.normals;S.fromArray(e,t),I.fromArray(e,s),T.fromArray(e,r),y.subVectors(T,I),D.subVectors(S,I),y.cross(D),y.normalize(),i.push(y.x,y.y,y.z),i.push(y.x,y.y,y.z),i.push(y.x,y.y,y.z)},addColor:function(t,s,r){const e=this.colors,i=this.object.geometry.colors;e[t]!==void 0&&i.push(e[t+0],e[t+1],e[t+2]),e[s]!==void 0&&i.push(e[s+0],e[s+1],e[s+2]),e[r]!==void 0&&i.push(e[r+0],e[r+1],e[r+2])},addUV:function(t,s,r){const e=this.uvs,i=this.object.geometry.uvs;i.push(e[t+0],e[t+1]),i.push(e[s+0],e[s+1]),i.push(e[r+0],e[r+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const s=this.uvs;this.object.geometry.uvs.push(s[t+0],s[t+1])},addFace:function(t,s,r,e,i,c,o,a,n){const h=this.vertices.length;let l=this.parseVertexIndex(t,h),u=this.parseVertexIndex(s,h),p=this.parseVertexIndex(r,h);if(this.addVertex(l,u,p),this.addColor(l,u,p),o!==void 0&&o!==""){const m=this.normals.length;l=this.parseNormalIndex(o,m),u=this.parseNormalIndex(a,m),p=this.parseNormalIndex(n,m),this.addNormal(l,u,p)}else this.addFaceNormal(l,u,p);if(e!==void 0&&e!==""){const m=this.uvs.length;l=this.parseUVIndex(e,m),u=this.parseUVIndex(i,m),p=this.parseUVIndex(c,m),this.addUV(l,u,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const s=this.vertices.length;for(let r=0,e=t.length;r<e;r++){const i=this.parseVertexIndex(t[r],s);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(t,s){this.object.geometry.type="Line";const r=this.vertices.length,e=this.uvs.length;for(let i=0,c=t.length;i<c;i++)this.addVertexLine(this.parseVertexIndex(t[i],r));for(let i=0,c=s.length;i<c;i++)this.addUVLine(this.parseUVIndex(s[i],e))}};return L.startObject("",!1),L}class ne extends E{constructor(t){super(t),this.materials=null}load(t,s,r,e){const i=this,c=new H(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(o){try{s(i.parse(o))}catch(a){e?e(a):console.error(a),i.manager.itemError(t)}},r,e)}setMaterials(t){return this.materials=t,this}parse(t){const s=new se;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const r=t.split(`
`);let e=[];for(let o=0,a=r.length;o<a;o++){const n=r[o].trimStart();if(n.length===0)continue;const h=n.charAt(0);if(h!=="#")if(h==="v"){const l=n.split(R);switch(l[0]){case"v":s.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),l.length>=7?(V.setRGB(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6])).convertSRGBToLinear(),s.colors.push(V.r,V.g,V.b)):s.colors.push(void 0,void 0,void 0);break;case"vn":s.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":s.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(h==="f"){const u=n.slice(1).trim().split(R),p=[];for(let f=0,g=u.length;f<g;f++){const b=u[f];if(b.length>0){const v=b.split("/");p.push(v)}}const m=p[0];for(let f=1,g=p.length-1;f<g;f++){const b=p[f],v=p[f+1];s.addFace(m[0],b[0],v[0],m[1],b[1],v[1],m[2],b[2],v[2])}}else if(h==="l"){const l=n.substring(1).trim().split(" ");let u=[];const p=[];if(n.indexOf("/")===-1)u=l;else for(let m=0,f=l.length;m<f;m++){const g=l[m].split("/");g[0]!==""&&u.push(g[0]),g[1]!==""&&p.push(g[1])}s.addLineGeometry(u,p)}else if(h==="p"){const u=n.slice(1).trim().split(" ");s.addPointGeometry(u)}else if((e=Y.exec(n))!==null){const l=(" "+e[0].slice(1).trim()).slice(1);s.startObject(l)}else if(ee.test(n))s.object.startMaterial(n.substring(7).trim(),s.materialLibraries);else if($.test(n))s.materialLibraries.push(n.substring(7).trim());else if(te.test(n))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(e=n.split(" "),e.length>1){const u=e[1].trim().toLowerCase();s.object.smooth=u!=="0"&&u!=="off"}else s.object.smooth=!0;const l=s.object.currentMaterial();l&&(l.smooth=s.object.smooth)}else{if(n==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+n+'"')}}s.finalize();const i=new J;if(i.materialLibraries=[].concat(s.materialLibraries),!(s.objects.length===1&&s.objects[0].geometry.vertices.length===0)===!0)for(let o=0,a=s.objects.length;o<a;o++){const n=s.objects[o],h=n.geometry,l=n.materials,u=h.type==="Line",p=h.type==="Points";let m=!1;if(h.vertices.length===0)continue;const f=new P;f.setAttribute("position",new j(h.vertices,3)),h.normals.length>0&&f.setAttribute("normal",new j(h.normals,3)),h.colors.length>0&&(m=!0,f.setAttribute("color",new j(h.colors,3))),h.hasUVIndices===!0&&f.setAttribute("uv",new j(h.uvs,2));const g=[];for(let v=0,F=l.length;v<F;v++){const x=l[v],O=x.name+"_"+x.smooth+"_"+m;let d=s.materials[O];if(this.materials!==null){if(d=this.materials.create(x.name),u&&d&&!(d instanceof C)){const w=new C;U.prototype.copy.call(w,d),w.color.copy(d.color),d=w}else if(p&&d&&!(d instanceof _)){const w=new _({size:10,sizeAttenuation:!1});U.prototype.copy.call(w,d),w.color.copy(d.color),w.map=d.map,d=w}}d===void 0&&(u?d=new C:p?d=new _({size:1,sizeAttenuation:!1}):d=new q,d.name=x.name,d.flatShading=!x.smooth,d.vertexColors=m,s.materials[O]=d),g.push(d)}let b;if(g.length>1){for(let v=0,F=l.length;v<F;v++){const x=l[v];f.addGroup(x.groupStart,x.groupCount,v)}u?b=new z(f,g):p?b=new A(f,g):b=new B(f,g)}else u?b=new z(f,g[0]):p?b=new A(f,g[0]):b=new B(f,g[0]);b.name=n.name,i.add(b)}else if(s.vertices.length>0){const o=new _({size:1,sizeAttenuation:!1}),a=new P;a.setAttribute("position",new j(s.vertices,3)),s.colors.length>0&&s.colors[0]!==void 0&&(a.setAttribute("color",new j(s.colors,3)),o.vertexColors=!0);const n=new A(a,o);i.add(n)}return i}}class ae extends E{constructor(t){super(t)}load(t,s,r,e){const i=this,c=this.path===""?N.extractUrlBase(t):this.path,o=new H(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){try{s(i.parse(a,c))}catch(n){e?e(n):console.error(n),i.manager.itemError(t)}},r,e)}setMaterialOptions(t){return this.materialOptions=t,this}parse(t,s){const r=t.split(`
`);let e={};const i=/\s+/,c={};for(let a=0;a<r.length;a++){let n=r[a];if(n=n.trim(),n.length===0||n.charAt(0)==="#")continue;const h=n.indexOf(" ");let l=h>=0?n.substring(0,h):n;l=l.toLowerCase();let u=h>=0?n.substring(h+1):"";if(u=u.trim(),l==="newmtl")e={name:u},c[u]=e;else if(l==="ka"||l==="kd"||l==="ks"||l==="ke"){const p=u.split(i,3);e[l]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else e[l]=u}const o=new ie(this.resourcePath||s,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(c),o}}class ie{constructor(t="",s={}){this.baseUrl=t,this.options=s,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:W,this.wrap=this.options.wrap!==void 0?this.options.wrap:Z}setCrossOrigin(t){return this.crossOrigin=t,this}setManager(t){this.manager=t}setMaterials(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(t){if(!this.options)return t;const s={};for(const r in t){const e=t[r],i={};s[r]=i;for(const c in e){let o=!0,a=e[c];const n=c.toLowerCase();switch(n){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&a[0]===0&&a[1]===0&&a[2]===0&&(o=!1);break}o&&(i[n]=a)}}return s}preload(){for(const t in this.materialsInfo)this.create(t)}getIndex(t){return this.nameLookup[t]}getAsArray(){let t=0;for(const s in this.materialsInfo)this.materialsArray[t]=this.create(s),this.nameLookup[s]=t,t++;return this.materialsArray}create(t){return this.materials[t]===void 0&&this.createMaterial_(t),this.materials[t]}createMaterial_(t){const s=this,r=this.materialsInfo[t],e={name:t,side:this.side};function i(o,a){return typeof a!="string"||a===""?"":/^https?:\/\//i.test(a)?a:o+a}function c(o,a){if(e[o])return;const n=s.getTextureParams(a,e),h=s.loadTexture(i(s.baseUrl,n.url));h.repeat.copy(n.scale),h.offset.copy(n.offset),h.wrapS=s.wrap,h.wrapT=s.wrap,(o==="map"||o==="emissiveMap")&&(h.encoding=X),e[o]=h}for(const o in r){const a=r[o];let n;if(a!=="")switch(o.toLowerCase()){case"kd":e.color=new k().fromArray(a).convertSRGBToLinear();break;case"ks":e.specular=new k().fromArray(a).convertSRGBToLinear();break;case"ke":e.emissive=new k().fromArray(a).convertSRGBToLinear();break;case"map_kd":c("map",a);break;case"map_ks":c("specularMap",a);break;case"map_ke":c("emissiveMap",a);break;case"norm":c("normalMap",a);break;case"map_bump":case"bump":c("bumpMap",a);break;case"map_d":c("alphaMap",a),e.transparent=!0;break;case"ns":e.shininess=parseFloat(a);break;case"d":n=parseFloat(a),n<1&&(e.opacity=n,e.transparent=!0);break;case"tr":n=parseFloat(a),this.options&&this.options.invertTrProperty&&(n=1-n),n>0&&(e.opacity=1-n,e.transparent=!0);break}}return this.materials[t]=new q(e),this.materials[t]}getTextureParams(t,s){const r={scale:new G(1,1),offset:new G(0,0)},e=t.split(/\s+/);let i;return i=e.indexOf("-bm"),i>=0&&(s.bumpScale=parseFloat(e[i+1]),e.splice(i,2)),i=e.indexOf("-s"),i>=0&&(r.scale.set(parseFloat(e[i+1]),parseFloat(e[i+2])),e.splice(i,4)),i=e.indexOf("-o"),i>=0&&(r.offset.set(parseFloat(e[i+1]),parseFloat(e[i+2])),e.splice(i,4)),r.url=e.join(" ").trim(),r}loadTexture(t,s,r,e,i){const c=this.manager!==void 0?this.manager:K;let o=c.getHandler(t);o===null&&(o=new Q(c)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const a=o.load(t,r,e,i);return s!==void 0&&(a.mapping=s),a}}export{ae as M,ne as O};
